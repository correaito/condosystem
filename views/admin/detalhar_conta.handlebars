<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-blue text-white">
            <h4>Detalhes da Conta #{{conta.numero}}</h4>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-6">
                    <p><strong>Morador:</strong> {{#if
                        conta.morador.nome}}{{conta.morador.nome}}{{else}}{{conta.morador}}{{/if}}</p>
                    <p><strong>Apartamento:</strong> {{#if conta.morador.apto}}{{conta.morador.apto}}{{else}}N/A{{/if}}
                    </p>
                    <p><strong>Competência:</strong> {{conta.competencia}}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Data:</strong> {{formatDate conta.data}}</p>
                    <p><strong>Situação:</strong> {{conta.situacao}}</p>
                    <p><strong>Valor Total:</strong> R$ {{conta.valor}}</p>
                </div>
            </div>

            <hr>

            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5>Despesas</h5>
                <a href="/admin/add_despesa/{{conta._id}}" class="btn btn-success"><i class="fa-solid fa-plus"></i>
                    Adicionar Despesa</a>
            </div>

            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>Descrição</th>
                            <th>Valor</th>
                            <th>Competência</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each despesas}}
                        <tr>
                            <td class="align-middle">{{this.descricao}}</td>
                            <td class="align-middle">R$ {{this.valor}}</td>
                            <td class="align-middle">{{this.competencia}}</td>
                            <td class="align-middle text-center">
                                <i onclick="excluirDespesa('{{this._id}}', '{{../conta._id}}')"
                                    class="fa-solid fa-trash text-danger" style="cursor: pointer;"
                                    title="Excluir Despesa"></i>
                            </td>
                        </tr>
                        {{else}}
                        <tr>
                            <td colspan="4" class="text-center">Nenhuma despesa encontrada.</td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>

            <hr>

            <h5>Pagamentos e Saldos</h5>
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th>Tipo</th>
                            <th>Valor</th>
                            <th>Situação</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each pagamentos}}
                        <tr>
                            <td>Pagamento</td>
                            <td>R$ {{this.valor}}</td>
                            <td>Realizado</td>
                            <td>{{formatDate this.date}}</td>
                        </tr>
                        {{/each}}
                        {{#each saldos}}
                        <tr>
                            <td>Saldo</td>
                            <td>R$ {{this.valor}}</td>
                            <td>{{this.situacao}}</td>
                            <td>{{formatDate this.date}}</td>
                        </tr>
                        {{/each}}
                        {{#unless pagamentos.length}}
                        {{#unless saldos.length}}
                        <tr>
                            <td colspan="4" class="text-center">Nenhum pagamento ou saldo registrado.</td>
                        </tr>
                        {{/unless}}
                        {{/unless}}
                    </tbody>
                </table>
            </div>

            <div class="mt-3">
                <a href="/admin/listar_contas" class="btn btn-secondary">Voltar</a>
                <a href="/admin/imprimir_fatura/{{conta._id}}" target="_blank" class="btn btn-primary"><i
                        class="fa-solid fa-print"></i> Imprimir Fatura</a>
            </div>
        </div>
    </div>
</div>

<script>
    function excluirDespesa(despesaId, contaId) {
        if (confirm('Tem certeza que deseja excluir esta despesa?')) {
            window.location.href = `/admin/excluir_despesa/${despesaId}/${contaId}`;
        }
    }
</script>