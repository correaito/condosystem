<div class="container col-12">
    <div class="card bg-blue mb-3 z-depth-1">
        <div class="card-header">
            Dashboard
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">
                <div class="container mt-4">
                    <div class="row">
                        <div class="col-12">
                            <h2 style="color: rgba(21, 10, 10, 0.67)">Bem-vindo(a), {{usuario.nome}}!</h2>
                        </div>
                    </div>

                    {{#if moradorNaoEncontrado}}
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="alert alert-info" role="alert">
                                <h4 class="alert-heading"><i class="fas fa-info-circle"></i> Atenção!</h4>
                                <p>Seu usuário ainda não está vinculado a um cadastro de Morador.</p>
                                <hr>
                                <p class="mb-0">Por favor, entre em contato com o síndico ou administrador para
                                    regularizar seu cadastro e visualizar suas informações financeiras.</p>
                            </div>
                        </div>
                    </div>
                    {{/if}}

                    <div class="row mt-4">
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="card red_light text-white bg-danger z-depth-1">
                                <div class="card-body">
                                    <h5 class="card-title">{{#if isAdmin}}Total Contas Pendentes (R$){{else}}Contas
                                        Pendentes (R$){{/if}}</h5>
                                    <p class="text_card_dash">R$ {{totalContasPendentes}}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="card blue_light text-white bg-primary z-depth-1">
                                <div class="card-body">
                                    <h5 class="card-title">{{#if isAdmin}}Saldo Total Moradores (R$){{else}}Saldo
                                        Morador (R$){{/if}}</h5>
                                    <p class="text_card_dash">R$ {{saldo}}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="card green_light text-white bg-primary z-depth-1">
                                <div class="card-body">
                                    <h5 class="card-title">Total Caixinhas (R$)</h5>
                                    <p class="text_card_dash">R$ {{totalCaixinhas}}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-md-6 mb-4">
                            <div class="card z-depth-1">
                                <div class="card-body">
                                    <h5 class="card-title">{{#if isAdmin}}Gráfico de Contas Totais{{else}}Gráfico de
                                        Contas{{/if}}</h5>
                                    <div id="bar-chart" style="width: 100%; height: 400px;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-4">
                            <div class="card z-depth-1">
                                <div class="card-body">
                                    <h5 class="card-title">Despesas do Mês</h5>
                                    <div id="pie-chart" style="width: 100%; height: 400px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="card z-depth-1">
                                <div class="card-body">
                                    <h5 class="card-title">{{#if isAdmin}}Últimas Despesas{{else}}Suas últimas
                                        Contas{{/if}}</h5>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    {{#if isAdmin}}
                                                    <th>Descrição</th>
                                                    <th>Competência</th>
                                                    <th>Valor</th>
                                                    {{else}}
                                                    <th>Número</th>
                                                    <th>Competência</th>
                                                    <th>Valor</th>
                                                    <th>Situação</th>
                                                    {{/if}}
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {{#each contas}}
                                                <tr>
                                                    {{#if ../isAdmin}}
                                                    <td>{{descricao}}</td>
                                                    <td>{{competencia}}</td>
                                                    <td>R$ {{valor}}</td>
                                                    {{else}}
                                                    <td>{{numero}}</td>
                                                    <td>{{competencia}}</td>
                                                    <td>R$ {{valor}}</td>
                                                    <td>{{situacao}}</td>
                                                    {{/if}}
                                                </tr>
                                                {{/each}}
                                            </tbody>
                                        </table>
                                        {{#if isAdmin}}
                                        <div class="text-right">
                                            <a href="/admin/listar_despesas" class="btn btn-link waves-effect">Ver
                                                Mais</a>
                                        </div>
                                        {{/if}}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>
    </div>
</div>

<script>
    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.setOnLoadCallback(drawCharts);

    function drawCharts() {
        drawBarChart();
        drawPieChart();
    }

    function drawBarChart() {
        const labelsMeses = JSON.parse('{{{labelsMeses}}}');
        const valoresContas = JSON.parse('{{{valoresContas}}}');


        const mesTraducoes = {
            'January': 'Janeiro',
            'February': 'Fevereiro',
            'March': 'Março',
            'April': 'Abril',
            'May': 'Maio',
            'June': 'Junho',
            'July': 'Julho',
            'August': 'Agosto',
            'September': 'Setembro',
            'October': 'Outubro',
            'November': 'Novembro',
            'December': 'Dezembro'
        };

        function traduzirMeses(meses) {
            return meses.map(mes => {
                const [mesNome, ano] = mes.split(' ');
                const mesTraduzido = mesTraducoes[mesNome] || mesNome;
                return `${mesTraduzido} ${ano}`;
            });
        }

        const labelsMesesTraduzidos = traduzirMeses(labelsMeses);

        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Mês');
        data.addColumn('number', 'Valor');

        for (let i = 0; i < labelsMesesTraduzidos.length; i++) {
            data.addRow([labelsMesesTraduzidos[i], valoresContas[i]]);
        }

        var options = {
            backgroundColor: 'transparent',
            colors: ['cornflowerblue'],
            fontName: 'Open Sans',
            chartArea: {
                left: 50,
                top: 10,
                width: '100%',
                height: '70%'
            },
            bar: {
                groupWidth: '80%'
            },
            hAxis: {
                textStyle: {
                    fontSize: 11
                }
            },
            vAxis: {
                minValue: 0,
                baselineColor: '#DDD',
                gridlines: {
                    color: '#DDD',
                    count: 4
                },
                textStyle: {
                    fontSize: 11
                }
            },
            legend: {
                position: 'none'
            },
            animation: {
                duration: 1200,
                easing: 'out',
                startup: true
            }
        };

        var chart = new google.visualization.ColumnChart(document.getElementById('bar-chart'));
        chart.draw(data, options);
    }

    function drawPieChart() {
        const despesasLabels = JSON.parse('{{{despesasLabels}}}');
        const despesasValores = JSON.parse('{{{despesasValores}}}');


        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Descrição');
        data.addColumn('number', 'Valor');

        for (let i = 0; i < despesasLabels.length; i++) {
            data.addRow([despesasLabels[i], despesasValores[i]]);
        }

        var options = {
            backgroundColor: 'transparent',
            colors: ['cornflowerblue', 'olivedrab', 'orange', 'tomato', 'crimson', 'purple', 'turquoise', 'forestgreen', 'navy', 'gray'],
            fontName: 'Open Sans',
            chartArea: {
                width: '100%',
                height: '80%'
            },
            legend: {
                textStyle: {
                    fontSize: 13
                }
            },
            pieSliceText: 'value',
            tooltip: {
                text: 'percentage'
            },
            animation: {
                duration: 1200,
                easing: 'out',
                startup: true
            }
        };

        var chart = new google.visualization.PieChart(document.getElementById('pie-chart'));
        chart.draw(data, options);
    }
</script>